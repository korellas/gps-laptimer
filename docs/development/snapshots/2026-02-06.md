# Current Status Snapshot (2026-02-06)

This file summarizes the major behavior now present in the codebase so teammates can quickly align.

## Completed Changes

### 1) Display bring-up and stability
- LCD init/flush path aligned to Waveshare-style flow.
- Backlight path uses PWM behavior compatible with this board.
- LVGL flush uses synchronized DMA chunk uploads (flush done callback + semaphore).
- Result: panel init and flush logs are consistently observed on boot.

### 2) Console and flashing workflow
- Serial command input is VFS-based (stdin/stdout), not direct UART0 driver binding.
- Console config uses USB Serial/JTAG.
- This avoids pin conflict with GPS UART pins.

### 3) Default runtime mode
- Boot default mode is simulation.
- Real GPS mode can still be toggled from serial command (`e`).

### 4) Delta model update
- Time delta remains the large center text.
- Speed delta was added as a separate metric:
  - computed at matched reference position
  - includes fallback to derivative speed when direct speed is invalid
  - smoothed for UI stability
- Speed delta now drives the background bar behavior.

### 5) UI revision
- Top center: lap number (`LAP 01`)
- Top right: rolling lap time (`m:ss.d`)
- Below top-right: best lap (`BEST m:ss:cc`)
- Center: delta seconds text (white, no zero-padded tens)
  - examples: `+1.34`, `-21.22`, `+0.00`
- Dynamic speed text at bar edge:
  - examples: `+1.2km/h`, `-1.2km/h`
  - follows moving bar end each update

### 6) Color policy
- Faster/green color: `#14AA14`
- Slower/red color: `#AA1414`
- Applied consistently to bar and speed delta edge text.

## Files Most Relevant To These Changes
- `main/waveshare_display.cpp`
- `main/main.cpp`
- `main/types.h`
- `main/serial_commands.cpp`
- `sdkconfig`
- `sdkconfig.defaults`

## Notes For Next Collaborator
- If changing display flush path, verify first-flush logs and visible output together.
- If changing mode defaults, keep `CLAUDE.md` and this status doc in sync.
- If changing UI typography/colors, update architecture/status docs in the same PR.
